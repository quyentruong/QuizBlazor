@page "/"
@using QuizBlazor.Models;

<PageTitle>Index</PageTitle>

@if (randomQuizzes != null && randomQuizzes.Count() > 0)
{
    if (currentQuesNumber < randomQuizzes.Count())
    {
        var q = randomQuizzes[currentQuesNumber];
        var shuffleAnswers = q.Answers.Shuffle();
        var correctAnswer = shuffleAnswers.Where(x => x.IsCorrect).FirstOrDefault();
        <MudGrid Class="flex-row-reverse">
            <MudItem xs="12" sm="2">
                <div class="d-flex">
                    <MudPaper Style="text-align:center;color:#060;background-color:#f9f9f9;font-size:30px;" Width="57px" Height="64px">
                        <div style="margin-top:-7px">
                            <svg style="height:14px;width:14px;" aria-hidden="true" data-prefix="fas" data-icon="check-circle" class="svg-inline--fa fa-check-circle fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"></path></svg>
                        </div>
                        <div style="margin-top:-16px">
                            <span>@totalCorrect</span>
                        </div>
                        @*<MudIcon Color="Color.Success" Icon="@Icons.Material.Filled.CheckCircleOutline"></MudIcon>*@
                    </MudPaper>
                    <MudPaper Style="text-align:center;color:#c33;background-color:#f9f9f9;font-size:30px;" Width="57px" Height="64px">
                        <div style="margin-top:-7px">
                            <svg style="height:14px;width:14px;" aria-hidden="true" data-prefix="fas" data-icon="times-circle" class="svg-inline--fa fa-times-circle fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"></path></svg>
                        </div>
                        <div style="margin-top:-16px">
                            <span>@totalInCorrect</span>
                        </div>
                    </MudPaper>
                </div>
            </MudItem>
            @if (!isAnswer)
            {
                <MudItem xs="12" sm="10">
                    <MudText>Question @(currentQuesNumber + 1) of @maxQuestion</MudText>
                    <MudText Class="d-inline-flex" Typo="Typo.h5">@q.Question</MudText>
                    <MudRadioGroup SelectedOptionChanged="@(new EventCallback<string>(this, OptionChanged))">

                        @foreach (var a in shuffleAnswers)
                        {
                            <MudRadio Class="d-flex" Option="a.IsCorrect.ToString()"><MudMarkdown CodeBlockTheme="CodeBlockTheme.A11yLight" Value="@a.Name" /></MudRadio>
                        }

                    </MudRadioGroup>
                </MudItem>

            }
            else
            {
                <MudItem xs="12" sm="10">
                    <MudStack Row="false">
                        @if (selectedOption.Equals("False"))
                        {
                            <AutoPlaySound Src="sound/incorrect.mp3" />
                            <MudText Color="Color.Error" Class="d-inline-flex" Typo="Typo.h5">Sorry, your answer is incorrect.</MudText>
                            <MudText Typo="Typo.h6" Color="Color.Dark">The correct answer is <MudMarkdown CodeBlockTheme="CodeBlockTheme.A11yLight" Value="@correctAnswer?.Name" /></MudText>
                        }
                        else if (selectedOption.Equals("True"))
                        {
                            <AutoPlaySound Src="sound/correct.mp3" />
                            <MudText Color="Color.Success" Class="d-inline-flex" Typo="Typo.h5">Correct.</MudText>
                        }
                    </MudStack>
                    <MudStack Row="false">
                        @if (currentQuesNumber == randomQuizzes.Count() - 1)
                        {
                            if (totalInCorrect >= totalCorrect)
                            {
                                <AutoPlaySound Src="sound/fail.mp3" />
                                <MudText Color="Color.Error"  Typo="Typo.h4">You failed the quiz.</MudText>
                            } else
                            {
                                <AutoPlaySound Src="sound/pass.mp3" />
                                <MudText Color="Color.Success"  Typo="Typo.h4">You passed the quiz.</MudText>
                            }
                            <MudButton Variant="Variant.Filled" Style="max-width:fit-content;" StartIcon="@Icons.Material.Filled.Autorenew" Color="Color.Primary" OnClick="()=>Restart()">Restart</MudButton>
                        }
                        else
                        {
                            <MudButton Variant="Variant.Filled" Style="max-width:fit-content;" StartIcon="@Icons.Material.Filled.ChevronRight" Color="Color.Info" OnClick="()=>NextQuestion()">Next Question</MudButton>
                        }
                    </MudStack>

                </MudItem>

            }

        </MudGrid>
    }
    else
    {
        <p>No more question</p>
        <MudButton OnClick="()=>Restart()">Restart</MudButton>
    }
}
